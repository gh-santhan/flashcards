<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Flashcards</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
<header>
  <div class="wrap topbar">
    <h1>Flashcards</h1>
    <div class="row">
      <button id="btnLogin" class="ghost">Log in</button>
      <span id="whoami" class="small"></span>
      <button id="btnLogout" class="ghost" style="display:none">Log out</button>
    </div>
  </div>

  <!-- Collapsible study controls -->
  <div class="wrap">
    <details id="controls" open>
      <summary class="summary-btn">Study Controls</summary>
      <div class="controls">
        <div class="row">
          <label>Chapter <select id="selChapter"></select></label>
          <label>Topic <select id="selTopic"></select></label>
          <button id="btnMix" class="ghost">Mix All</button>
          <button id="btnSearch" class="ghost">Search</button>
        </div>
        <div class="chips" id="diffChips">
          <span class="chip" data-diff="again">Again <span class="count" id="cnt-again">0</span></span>
          <span class="chip" data-diff="hard">Hard <span class="count" id="cnt-hard">0</span></span>
          <span class="chip" data-diff="good">Good <span class="count" id="cnt-good">0</span></span>
          <span class="chip" data-diff="easy">Easy <span class="count" id="cnt-easy">0</span></span>
          <span class="chip" data-diff="ungraded">Ungraded <span class="count" id="cnt-ungraded">0</span></span>
          <span class="chip" id="chip-star">‚òÖ Starred <span class="count" id="cnt-star">0</span></span>
        </div>
      </div>
    </details>
  </div>

  <div class="wrap tabs">
    <div class="tab on" data-tab="study">Study</div>
    <div class="tab" data-tab="editor">Editor</div>
    <div class="tab" data-tab="admin">Admin</div>
  </div>
</header>

<main class="wrap">
  <!-- STUDY -->
  <section id="tab-study">
    <section class="card">
      <div class="meta">
        <span id="metaChap" class="badge">‚Äî</span>
        <span id="metaTopics" class="badge">‚Äî</span>
        <span id="metaSection" class="badge">‚Äî</span>
        <span id="metaTags" class="badge">‚Äî</span>
        <span id="metaIndex" class="badge">0/0</span>
        <span id="metaResources" class="badge" style="display:none">Resources ‚Ä¢ <span id="resCount">0</span></span>
        <span id="metaEditor" style="margin-left:auto; display:none">
          <button id="btnEditCard" class="ghost">‚úé Edit</button>
          <button id="btnDeleteCard" class="danger">üóë Delete</button>
        </span>
      </div>

      <div class="q" id="q">‚Äî</div>

      <div class="actions">
        <button id="btnReveal" class="primary">Reveal</button>
        <button id="btnPrev" class="ghost">‚óÄ Prev</button>
        <button id="btnNext" class="ghost">Next ‚ñ∂</button>
        <button id="btnSuspend" class="ghost" title="Suspend/Unsuspend">‚è∏ Suspend</button>
        <button id="btnStar" class="ghost" title="Star/Unstar">‚òÜ Star</button>
      </div>

      <div id="ans" class="ans"></div>

      <div id="gradeRow" class="grade">
        <button class="g again" id="gAgain">Again</button>
        <button class="g hard" id="gHard">Hard</button>
        <button class="g good" id="gGood">Good</button>
        <button class="g easy" id="gEasy">Easy</button>
      </div>

      <div class="resources" id="resWrap" style="display:none">
        <div class="small">Resources</div>
        <div id="resList" class="res-list"></div>
      </div>
    </section>
  </section>

  <!-- EDITOR -->
  <section id="tab-editor" style="display:none">
    <div class="etabs">
      <div class="etab on" data-etab="cards">Cards</div>
      <div class="etab" data-etab="chapters">Chapters</div>
      <div class="etab" data-etab="topics">Topics</div>
      <div class="etab" data-etab="tags">Tags</div>
    </div>

    <section id="editor-cards">
      <p class="subtitle">Edit cards inline or open a card to modify front, back, tags, topics, notes/resources.</p>
      <table id="tblCards">
        <thead><tr><th>Front</th><th>Chapter</th><th>Topics</th><th>Tags</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>
      <div class="divider"></div>
      <button id="btnBulkDelete" class="danger">Bulk Delete‚Ä¶</button>
    </section>

    <section id="editor-chapters" style="display:none">
      <p class="subtitle">Rename a chapter or delete it. Deleting a chapter will NOT delete cards.</p>
      <table id="tblChapters">
        <thead><tr><th>Chapter</th><th>Cards</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="editor-topics" style="display:none">
      <p class="subtitle">Rename or delete a topic. Deleting a topic removes links from cards.</p>
      <table id="tblTopics">
        <thead><tr><th>Topic</th><th>Cards</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="editor-tags" style="display:none">
      <p class="subtitle">Rename or delete a tag.</p>
      <table id="tblTags">
        <thead><tr><th>Tag</th><th>Cards</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>
  </section>

  <!-- ADMIN -->
  <section id="tab-admin" style="display:none">
    <div class="divider"></div>
    <h3>Import JSON</h3>
    <div class="row">
      <input id="fileImport" type="file" accept=".json"/>
      <button id="btnImport" class="primary">Import</button>
    </div>

    <div class="divider"></div>
    <h3>Authoring Aids</h3>
    <div class="row">
      <button id="btnDownloadTemplate" class="ghost">Download JSON Template</button>
      <button id="btnOpenLLM" class="ghost">LLM Instructions</button>
    </div>
    <div class="small" style="margin-top:6px">
      The template matches the importer format.
    </div>
  </section>
</main>

<!-- Modals (search/edit/bulk/llm) left as-is from your working copy -->

<script type="module">
  import './js/config.js';            // exports constants
  import './js/supabaseClient.js';    // creates and exports supabase client
  import './js/repo.js';              // data layer
  import './js/main.js';              // UI wiring (calls repo & supabase)
</script>
</body>
</html>
